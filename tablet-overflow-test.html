<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tablet Overflow Debug Test</title>
    <link rel="stylesheet" href="src/assets/styles/main.css">
    <style>
        /* Test-specific styles for debugging */
        .debug-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            z-index: 9999;
            line-height: 1.4;
        }
        
        .viewport-controls {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ccc;
            z-index: 9998;
            font-family: system-ui;
        }
        
        .overflow-indicator {
            position: absolute;
            background: rgba(255, 0, 0, 0.3);
            border: 2px solid red;
            pointer-events: none;
            z-index: 9997;
        }
        
        /* Simulate different tablet widths */
        .test-width-934 { width: 934px !important; }
        .test-width-768 { width: 768px !important; }
        .test-width-1024 { width: 1024px !important; }
        
        /* Debug outline for main layout elements */
        .debug-outline .app-header,
        .debug-outline .app-sidebar,
        .debug-outline .app-main,
        .debug-outline .app-footer {
            outline: 2px solid;
        }
        
        .debug-outline .app-header { outline-color: blue; }
        .debug-outline .app-sidebar { outline-color: green; }
        .debug-outline .app-main { outline-color: orange; }
        .debug-outline .app-footer { outline-color: purple; }
    </style>
</head>
<body>
    <!-- Debug Info Panel -->
    <div class="debug-info" id="debugInfo">
        <div>Viewport: <span id="viewportSize">Loading...</span></div>
        <div>Mode: <span id="responsiveMode">Loading...</span></div>
        <div>Sidebar: <span id="sidebarInfo">Loading...</span></div>
        <div>Header Width: <span id="headerWidth">Loading...</span></div>
        <div>Footer Width: <span id="footerWidth">Loading...</span></div>
        <div>Overflow Check: <span id="overflowStatus">Loading...</span></div>
    </div>

    <!-- Viewport Controls -->
    <div class="viewport-controls">
        <h4 style="margin: 0 0 10px 0;">Tablet Test Controls</h4>
        <button onclick="setTestWidth(934)">934px (Problem Width)</button>
        <button onclick="setTestWidth(768)">768px (Min Tablet)</button>
        <button onclick="setTestWidth(1024)">1024px (Max Tablet)</button>
        <button onclick="resetWidth()">Reset Width</button>
        <br><br>
        <label>
            <input type="checkbox" id="debugOutlines" onchange="toggleDebugOutlines()">
            Show Debug Outlines
        </label>
        <br>
        <label>
            <input type="checkbox" id="compactMode" onchange="toggleCompactMode()">
            Sidebar Compact Mode
        </label>
        <br><br>
        <button onclick="analyzeOverflow()">Analyze Overflow</button>
        <button onclick="logDimensions()">Log All Dimensions</button>
    </div>

    <!-- Main App Layout -->
    <div class="app-layout">
        <!-- Sidebar -->
        <aside class="app-sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <h2>Opinion</h2>
                </div>
                <button class="sidebar-toggle-btn" title="Toggle sidebar">
                    <span class="toggle-icon">‚Æê</span>
                </button>
            </div>
            
            <nav class="sidebar-navigation">
                <ul class="sidebar-nav-list">
                    <li class="sidebar-nav-item">
                        <a href="#" class="sidebar-nav-link">
                            <span class="nav-icon">üè†</span>
                            <span class="nav-label">Dashboard</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="#" class="sidebar-nav-link">
                            <span class="nav-icon">üìä</span>
                            <span class="nav-label">Analytics</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="#" class="sidebar-nav-link">
                            <span class="nav-icon">‚öôÔ∏è</span>
                            <span class="nav-label">Settings</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="sidebar-footer">
                <div class="sidebar-footer-content">
                    <p class="sidebar-footer-text">¬© 2024 Opinion</p>
                </div>
            </div>
        </aside>

        <!-- Header -->
        <header class="app-header">
            <div class="header-container">
                <div class="header-content">
                    <div class="header-left-panel">
                        <button class="mobile-menu-btn">
                            <span class="mobile-menu-icon">‚ò∞</span>
                        </button>
                        <div class="header-logo">
                            <h1>Opinion App</h1>
                        </div>
                    </div>
                    
                    <div class="header-center-panel">
                        <div class="header-search-container">
                            <input type="search" class="header-search-input" placeholder="Search...">
                            <button class="header-search-btn">üîç</button>
                        </div>
                    </div>
                    
                    <div class="header-right-panel">
                        <button class="header-notification-btn">üîî</button>
                        <div class="user-menu">
                            <button class="user-menu-trigger">
                                <span class="user-menu-name">Demo User</span>
                                <span class="user-menu-avatar">üë§</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Scrollable content area containing main + footer -->
        <div class="app-content-scroll">
            <!-- Main Content -->
            <main class="app-main">
                <div class="main-content">
                    <h2>Tablet Overflow Test Content</h2>
                    <p>This page tests tablet mode layout at various widths to identify overflow issues.</p>
                    
                    <div style="background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 8px;">
                        <h3>Test Instructions:</h3>
                        <ol>
                            <li>Use the controls in the bottom-right to test different tablet widths</li>
                            <li>Enable "Show Debug Outlines" to see component boundaries</li>
                            <li>Click "Analyze Overflow" to detect overflow issues automatically</li>
                            <li>Toggle compact mode to test sidebar width changes</li>
                            <li>Check the debug info panel for real-time measurements</li>
                        </ol>
                    </div>
                    
                    <div style="height: 400px; background: linear-gradient(45deg, #e3f2fd, #f3e5f5); display: flex; align-items: center; justify-content: center; border-radius: 8px;">
                        <h3>Main Content Area</h3>
                    </div>
                </div>
            </main>

            <!-- Footer -->
            <footer class="app-footer">
                <div class="footer-container">
                    <div class="footer-content">
                        <nav class="footer-navigation">
                            <div class="footer-navigation-left-panel">
                                <ul class="footer-nav-list">
                                    <li class="footer-nav-item">
                                        <a href="#" class="footer-nav-link">Privacy Policy</a>
                                    </li>
                                    <li class="footer-nav-item">
                                        <a href="#" class="footer-nav-link">Terms of Service</a>
                                    </li>
                                    <li class="footer-nav-item">
                                        <a href="#" class="footer-nav-link">Support</a>
                                    </li>
                                    <li class="footer-nav-item">
                                        <a href="#" class="footer-nav-link">Contact</a>
                                    </li>
                                </ul>
                            </div>
                        </nav>
                        <div class="footer-copyright-section">
                            <p class="footer-copyright-text">¬© 2024 Opinion App. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <script type="module">
        // Import the main app
        import './src/scripts/main.ts';
        
        // Debug utilities
        let debugInterval;
        
        function updateDebugInfo() {
            const viewport = {
                width: window.innerWidth,
                height: window.innerHeight
            };
            
            const sidebar = document.querySelector('.app-sidebar');
            const header = document.querySelector('.app-header');
            const footer = document.querySelector('.app-footer');
            
            document.getElementById('viewportSize').textContent = `${viewport.width}x${viewport.height}`;
            
            // Get responsive mode from layout context if available
            if (window.layoutContext) {
                const mode = window.layoutContext.getResponsiveMode();
                document.getElementById('responsiveMode').textContent = mode.type;
                document.getElementById('sidebarInfo').textContent = `${mode.sidebar.width}px (${mode.sidebar.isCompact ? 'compact' : 'expanded'})`;
            }
            
            if (header) {
                const headerRect = header.getBoundingClientRect();
                const headerStyles = window.getComputedStyle(header);
                document.getElementById('headerWidth').textContent = `${Math.round(headerRect.width)}px (left: ${Math.round(headerRect.left)}px)`;
            }
            
            if (footer) {
                const footerRect = footer.getBoundingClientRect();
                document.getElementById('footerWidth').textContent = `${Math.round(footerRect.width)}px (left: ${Math.round(footerRect.left)}px)`;
            }
            
            // Check for overflow
            checkOverflow();
        }
        
        function checkOverflow() {
            const sidebar = document.querySelector('.app-sidebar');
            const header = document.querySelector('.app-header');
            const footer = document.querySelector('.app-footer');
            
            let overflowIssues = [];
            
            if (sidebar && header) {
                const sidebarRect = sidebar.getBoundingClientRect();
                const headerRect = header.getBoundingClientRect();
                
                // Check if header overlaps with sidebar
                if (headerRect.left < sidebarRect.right) {
                    overflowIssues.push(`Header overlaps sidebar by ${Math.round(sidebarRect.right - headerRect.left)}px`);
                }
            }
            
            if (sidebar && footer) {
                const sidebarRect = sidebar.getBoundingClientRect();
                const footerRect = footer.getBoundingClientRect();
                
                // Check if footer overlaps with sidebar
                if (footerRect.left < sidebarRect.right) {
                    overflowIssues.push(`Footer overlaps sidebar by ${Math.round(sidebarRect.right - footerRect.left)}px`);
                }
            }
            
            document.getElementById('overflowStatus').textContent = 
                overflowIssues.length > 0 ? overflowIssues.join('; ') : 'No overflow detected';
        }
        
        window.setTestWidth = function(width) {
            document.body.style.width = width + 'px';
            document.body.style.maxWidth = width + 'px';
            document.body.style.overflow = 'hidden';
            
            // Trigger resize event
            window.dispatchEvent(new Event('resize'));
            
            setTimeout(updateDebugInfo, 100);
        };
        
        window.resetWidth = function() {
            document.body.style.width = '';
            document.body.style.maxWidth = '';
            document.body.style.overflow = '';
            
            window.dispatchEvent(new Event('resize'));
            setTimeout(updateDebugInfo, 100);
        };
        
        window.toggleDebugOutlines = function() {
            const checkbox = document.getElementById('debugOutlines');
            const layout = document.querySelector('.app-layout');
            if (checkbox.checked) {
                layout.classList.add('debug-outline');
            } else {
                layout.classList.remove('debug-outline');
            }
        };
        
        window.toggleCompactMode = function() {
            const checkbox = document.getElementById('compactMode');
            if (window.layoutContext) {
                if (checkbox.checked) {
                    window.layoutContext.setSidebarCompact(true);
                } else {
                    window.layoutContext.setSidebarCompact(false);
                }
                setTimeout(updateDebugInfo, 100);
            }
        };
        
        window.analyzeOverflow = function() {
            const results = [];
            const sidebar = document.querySelector('.app-sidebar');
            const header = document.querySelector('.app-header');
            const footer = document.querySelector('.app-footer');
            const main = document.querySelector('.app-main');
            
            if (!sidebar || !header || !footer) {
                alert('Layout components not found');
                return;
            }
            
            const sidebarRect = sidebar.getBoundingClientRect();
            const headerRect = header.getBoundingClientRect();
            const footerRect = footer.getBoundingClientRect();
            const mainRect = main.getBoundingClientRect();
            
            results.push('=== OVERFLOW ANALYSIS ===');
            results.push(`Viewport: ${window.innerWidth}x${window.innerHeight}`);
            results.push(`Sidebar: ${Math.round(sidebarRect.width)}px wide, right edge at ${Math.round(sidebarRect.right)}px`);
            results.push(`Header: left edge at ${Math.round(headerRect.left)}px, width ${Math.round(headerRect.width)}px`);
            results.push(`Footer: left edge at ${Math.round(footerRect.left)}px, width ${Math.round(footerRect.width)}px`);
            results.push(`Main: left edge at ${Math.round(mainRect.left)}px, width ${Math.round(mainRect.width)}px`);
            
            // Detailed overflow checks
            if (headerRect.left < sidebarRect.right) {
                results.push(`‚ùå HEADER OVERFLOW: ${Math.round(sidebarRect.right - headerRect.left)}px under sidebar`);
            } else {
                results.push(`‚úÖ Header positioned correctly`);
            }
            
            if (footerRect.left < sidebarRect.right) {
                results.push(`‚ùå FOOTER OVERFLOW: ${Math.round(sidebarRect.right - footerRect.left)}px under sidebar`);
            } else {
                results.push(`‚úÖ Footer positioned correctly`);
            }
            
            // Check for horizontal scrolling
            const hasHorizontalScroll = document.documentElement.scrollWidth > document.documentElement.clientWidth;
            if (hasHorizontalScroll) {
                results.push(`‚ùå HORIZONTAL SCROLL: Document width ${document.documentElement.scrollWidth}px > viewport ${document.documentElement.clientWidth}px`);
            } else {
                results.push(`‚úÖ No horizontal scrolling`);
            }
            
            console.log(results.join('\\n'));
            alert(results.join('\\n'));
        };
        
        window.logDimensions = function() {
            const sidebar = document.querySelector('.app-sidebar');
            const header = document.querySelector('.app-header');
            const footer = document.querySelector('.app-footer');
            
            const logs = [];
            
            if (sidebar) {
                const rect = sidebar.getBoundingClientRect();
                const styles = window.getComputedStyle(sidebar);
                logs.push('=== SIDEBAR ===');
                logs.push(`Position: ${rect.left}, ${rect.top}`);
                logs.push(`Size: ${rect.width}x${rect.height}`);
                logs.push(`CSS width: ${styles.width}`);
                logs.push(`CSS transform: ${styles.transform}`);
                logs.push(`CSS position: ${styles.position}`);
            }
            
            if (header) {
                const rect = header.getBoundingClientRect();
                const styles = window.getComputedStyle(header);
                logs.push('\\n=== HEADER ===');
                logs.push(`Position: ${rect.left}, ${rect.top}`);
                logs.push(`Size: ${rect.width}x${rect.height}`);
                logs.push(`CSS left: ${styles.left}`);
                logs.push(`CSS margin-left: ${styles.marginLeft}`);
                logs.push(`CSS grid-column: ${styles.gridColumn}`);
            }
            
            if (footer) {
                const rect = footer.getBoundingClientRect();
                const styles = window.getComputedStyle(footer);
                logs.push('\\n=== FOOTER ===');
                logs.push(`Position: ${rect.left}, ${rect.top}`);
                logs.push(`Size: ${rect.width}x${rect.height}`);
                logs.push(`CSS left: ${styles.left}`);
                logs.push(`CSS margin-left: ${styles.marginLeft}`);
                logs.push(`CSS grid-column: ${styles.gridColumn}`);
            }
            
            console.log(logs.join('\\n'));
        };
        
        // Start debug monitoring
        window.addEventListener('DOMContentLoaded', function() {
            debugInterval = setInterval(updateDebugInfo, 500);
            updateDebugInfo();
            
            // Also update on resize
            window.addEventListener('resize', function() {
                setTimeout(updateDebugInfo, 100);
            });
        });
        
        // Expose layout context globally for debugging
        window.addEventListener('load', function() {
            if (window.app && window.app.layoutContext) {
                window.layoutContext = window.app.layoutContext;
            }
        });
    </script>
</body>
</html>
