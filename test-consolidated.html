<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consolidated User Menu Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            padding-top: 70px;
        }

        /* Sidebar for testing */
        #app_sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 250px;
            height: 100vh;
            background: #f8f9ff;
            border-right: 1px solid #e3e6ea;
            padding: 20px;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 1020;
        }

        #app_sidebar.mobile-open {
            transform: translateX(0);
        }

        .main-content {
            margin-left: 0;
            padding: 20px;
            transition: margin-left 0.3s ease;
        }

        @media (min-width: 768px) {
            .main-content {
                margin-left: 250px;
            }
            
            #app_sidebar {
                transform: translateX(0);
            }
        }

        .test-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        button:hover {
            background: #0056b3;
        }

        .info {
            background: #e3f2fd;
            color: #1565c0;
            padding: 12px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #2196f3;
        }

        .success {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 12px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #4caf50;
        }

        #sidebar_mobile_close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0,0,0,0.1);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            font-size: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Sidebar for mobile menu testing -->
    <div id="app_sidebar">
        <h3>Sidebar Content</h3>
        <button id="sidebar_mobile_close">&times;</button>
        <p>This sidebar opens on mobile when you click the hamburger menu.</p>
    </div>

    <div class="main-content">
        <div class="test-section">
            <h1>üéØ Consolidated User Menu Test</h1>
            <div class="info">
                This test page verifies our simplified approach: <strong>ONE UserMenu component</strong> that adapts to both mobile and desktop using responsive CSS.
            </div>
            
            <div class="success">
                ‚úÖ <strong>Solution:</strong> UserMenu component with responsive styles<br>
                üì± <strong>Mobile:</strong> Shows as user icon (42x42px)<br>
                üíª <strong>Desktop:</strong> Shows as full user menu trigger<br>
                üîÑ <strong>Responsive:</strong> Automatically adapts via CSS media queries
            </div>
        </div>

        <div class="test-section">
            <h2>üß™ Test Controls</h2>
            <button onclick="initializeHeader()">Initialize Header</button>
            <button onclick="simulateUserLoading()">Simulate User Loading</button>
            <button onclick="testViewportInfo()">Show Viewport Info</button>
            <button onclick="testUserMenuClick()">Test User Menu Click</button>
            <button onclick="clearConsole()">Clear Console</button>
            <button onclick="testErrorMessages()">Test Error Messages</button>
        </div>
        
        <div class="test-section">
            <h2>üí¨ Error Messages Integration</h2>
            <p>Test the new error message functionality added to LayoutContext:</p>
            <button onclick="testBasicErrorMessages()">Test Basic Messages</button>
            <button onclick="testAdvancedMessages()">Test Advanced Features</button>
            <button onclick="openErrorMessagesTest()">Open Dedicated Test Page</button>
            
            <div class="info" style="margin-top: 15px;">
                <strong>‚ú® New LayoutContext Methods:</strong><br>
                ‚Ä¢ <code>layoutContext.showError(title, description)</code><br>
                ‚Ä¢ <code>layoutContext.showWarning(title, description)</code><br>
                ‚Ä¢ <code>layoutContext.showInfo(title, description)</code><br>
                ‚Ä¢ <code>layoutContext.showSuccess(title, description)</code><br>
                ‚Ä¢ <code>layoutContext.clearMessages()</code> and more!
            </div>
        </div>

        <div class="test-section">
            <h2>üì± Responsive Test Instructions</h2>
            <ol>
                <li><strong>Initialize Header:</strong> Click "Initialize Header" to create the header with UserMenu</li>
                <li><strong>Load User Data:</strong> Click "Simulate User Loading" to test user data updates</li>
                <li><strong>Test Mobile View:</strong> Resize browser to &lt;768px width or use dev tools mobile mode</li>
                <li><strong>Test Desktop View:</strong> Resize browser to ‚â•768px width</li>
                <li><strong>Click User Menu:</strong> Works on both mobile and desktop</li>
            </ol>
        </div>

        <div class="test-section">
            <h2>üëÄ Visual Verification</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h4>Mobile (&lt;768px):</h4>
                    <ul>
                        <li>Hamburger menu visible (left)</li>
                        <li>User icon visible (right)</li>
                        <li>User icon: 42x42px, centered</li>
                        <li>No username text visible</li>
                        <li>Dropdown opens as mobile modal</li>
                    </ul>
                </div>
                <div>
                    <h4>Desktop (‚â•768px):</h4>
                    <ul>
                        <li>Hamburger menu hidden</li>
                        <li>Full user trigger visible</li>
                        <li>Username text visible</li>
                        <li>Dropdown arrow visible</li>
                        <li>Dropdown opens below trigger</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { AppHeader } from './src/components/AppHeader.ts';
        
        let appHeader = null;

        window.initializeHeader = function() {
            console.log('üöÄ Initializing header...');
            
            if (appHeader) {
                console.log('üîÑ Destroying existing header...');
                appHeader.destroy();
            }
            
            appHeader = new AppHeader();
            appHeader.init();
            
            console.log('‚úÖ Header initialized!');
            console.log('üìä Current viewport:', window.innerWidth + 'px');
        };

        window.simulateUserLoading = function() {
            if (!appHeader) {
                console.warn('‚ùå Header not initialized. Click "Initialize Header" first.');
                return;
            }
            
            console.log('üîÑ Starting user loading simulation...');
            appHeader.simulateUserLoading();
        };

        window.testViewportInfo = function() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            const isMobile = width < 768;
            
            console.log('üìä Viewport Information:');
            console.log(`   Size: ${width}x${height}px`);
            console.log(`   Mode: ${isMobile ? 'Mobile' : 'Desktop'}`);
            console.log(`   UserMenu should show: ${isMobile ? 'Icon only' : 'Full trigger'}`);
            
            const userMenuTrigger = document.getElementById('user_menu_trigger');
            if (userMenuTrigger) {
                const styles = window.getComputedStyle(userMenuTrigger);
                console.log(`   UserMenu width: ${styles.width}`);
                console.log(`   UserMenu height: ${styles.height}`);
            }
        };

        window.testUserMenuClick = function() {
            const userMenuTrigger = document.getElementById('user_menu_trigger');
            if (userMenuTrigger) {
                console.log('üñ±Ô∏è Simulating user menu click...');
                userMenuTrigger.click();
            } else {
                console.warn('‚ùå User menu trigger not found. Initialize header first.');
            }
        };

        window.clearConsole = function() {
            console.clear();
            console.log('üßπ Console cleared');
        };
        
        // Error Messages Testing Functions
        window.testErrorMessages = function() {
            console.log('%cüí¨ Error Messages Test - Consolidated Page', 'color: #2563eb; font-weight: bold; font-size: 16px');
            console.log('This demonstrates the LayoutContext error message integration:');
            console.log('layoutContext.showError("Test Error", "Error from consolidated test page")');
            console.log('layoutContext.showSuccess("Test Success", "Error messages working in consolidated test!")');
        };
        
        window.testBasicErrorMessages = function() {
            console.log('%cüìù Basic Error Messages Test', 'color: #16a34a; font-weight: bold; font-size: 14px');
            
            const messages = [
                {type: 'ERROR', color: '#dc3545', call: 'layoutContext.showError("Connection Failed", "Network error occurred")'},
                {type: 'WARNING', color: '#fd7e14', call: 'layoutContext.showWarning("Session Warning", "Session will expire soon")'},
                {type: 'INFO', color: '#0dcaf0', call: 'layoutContext.showInfo("Feature Info", "New feature available")'},
                {type: 'SUCCESS', color: '#198754', call: 'layoutContext.showSuccess("Operation Success", "Data saved successfully")'}
            ];
            
            messages.forEach((msg, index) => {
                setTimeout(() => {
                    console.log(`%c${msg.type}:`, `color: ${msg.color}; font-weight: bold`, msg.call);
                }, index * 600);
            });
        };
        
        window.testAdvancedMessages = function() {
            console.log('%cüöÄ Advanced Message Features Test', 'color: #6f42c1; font-weight: bold; font-size: 14px');
            
            const features = [
                'errorMessages.addMessage({id: "action-msg", type: "error", actions: [{id: "retry", text: "Retry"}]})',
                'errorMessages.addMessage({id: "persistent-msg", type: "warning", persistent: true})',
                'errorMessages.addMessage({id: "auto-hide-msg", type: "info", autoHide: true, autoHideDelay: 3000})',
                'showMessageSequence() // Shows 5 messages in 2s intervals'
            ];
            
            features.forEach((feature, index) => {
                setTimeout(() => {
                    console.log(`%cAdvanced Feature ${index + 1}:`, 'color: #6f42c1; font-weight: bold', feature);
                }, index * 800);
            });
        };
        
        window.openErrorMessagesTest = function() {
            window.open('./test-error-messages.html', '_blank');
            console.log('üöÄ Opened dedicated Error Messages Test Page');
        };

        // Viewport change logging
        window.addEventListener('resize', () => {
            const width = window.innerWidth;
            const isMobile = width < 768;
            console.log(`üìê Viewport changed: ${width}px (${isMobile ? 'Mobile' : 'Desktop'})`);
        });

        // Log when page loads
        console.log('üìÑ Consolidated User Menu Test Page Loaded');
        console.log('üí° Click "Initialize Header" to begin testing');
    </script>
</body>
</html>
