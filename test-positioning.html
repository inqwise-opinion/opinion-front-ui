<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MainContent Positioning Test</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background: #f0f0f0;
    }
    
    .test-container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    .test-header {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
      padding: 20px;
      text-align: center;
    }
    
    .test-content {
      padding: 20px;
    }
    
    .test-section {
      margin-bottom: 24px;
      padding: 16px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #28a745;
    }
    
    .test-viewport {
      margin: 20px 0;
      padding: 20px;
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 8px;
    }
    
    .status-indicator {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 8px;
    }
    
    .status-success {
      background: #d4edda;
      color: #155724;
    }
    
    .status-warning {
      background: #fff3cd;
      color: #856404;
    }
    
    .status-error {
      background: #f8d7da;
      color: #721c24;
    }
    
    .error-test-button {
      background: #dc3545;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      margin-right: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    
    .error-test-button:hover {
      background: #c82333;
      transform: translateY(-1px);
    }
    
    .error-test-button.purple {
      background: #6f42c1;
    }
    
    .error-test-button.purple:hover {
      background: #5a32a3;
    }
    
    .error-test-button.blue {
      background: #3b82f6;
    }
    
    .error-test-button.blue:hover {
      background: #2563eb;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <div class="test-header">
      <h1>üéØ MainContent Positioning Test</h1>
      <p>Testing PageComponent positioning within MainContent across different viewports</p>
    </div>
    
    <div class="test-content">
      <div class="test-section">
        <h2>Test Status</h2>
        <div id="overall-status">
          <p>‚è≥ Running positioning tests...</p>
        </div>
      </div>
      
      <div class="test-section">
        <h2>Layout Structure Validation</h2>
        <div id="structure-tests">
          <div class="test-case">
            <span>‚úì CSS Grid Layout:</span>
            <span id="grid-status" class="status-indicator">Checking...</span>
          </div>
          <div class="test-case">
            <span>‚úì Header in Content Scroll:</span>
            <span id="header-status" class="status-indicator">Checking...</span>
          </div>
          <div class="test-case">
            <span>‚úì Main Content Flexbox:</span>
            <span id="main-status" class="status-indicator">Checking...</span>
          </div>
          <div class="test-case">
            <span>‚úì Page Content Positioning:</span>
            <span id="content-status" class="status-indicator">Checking...</span>
          </div>
        </div>
      </div>
      
      <div class="test-section">
        <h2>Viewport Tests</h2>
        <div id="viewport-tests">
          <!-- Viewport test results will be populated here -->
        </div>
      </div>
      
      <div class="test-section">
        <h2>üí¨ Error Messages Positioning Test</h2>
        <p>Test how error messages position and display within the layout structure:</p>
        <div id="error-message-tests">
          <div style="margin-bottom: 15px;">
            <button class="error-test-button" onclick="testErrorMessagePositioning()">
              üìù Test Error Message Positioning
            </button>
            <button class="error-test-button purple" onclick="testErrorMessagesInLayout()">
              üîó Test Layout Integration
            </button>
            <button class="error-test-button blue" onclick="openErrorMessageTest()">
              üöÄ Open Error Messages Test
            </button>
          </div>
          <div id="error-positioning-results" style="background: #f8f9fa; padding: 15px; border-radius: 6px; min-height: 60px;">
            <p><em>Click buttons above to test error message positioning within the layout structure.</em></p>
          </div>
        </div>
      </div>
      
      <div class="test-section">
        <h2>Live Preview with Error Messages</h2>
        <div style="margin-bottom: 15px; padding: 10px; background: #fff3cd; border-radius: 6px; border-left: 4px solid #ffc107;">
          <strong>‚ö†Ô∏è Interactive Testing:</strong> The buttons below will show actual error messages in the preview iframe to test real positioning.
        </div>
        <div style="margin-bottom: 15px;">
          <button class="error-test-button" onclick="showLiveErrorMessage('error')">
            ‚ùå Show Live Error
          </button>
          <button class="error-test-button purple" onclick="showLiveErrorMessage('warning')">
            ‚ö†Ô∏è Show Live Warning
          </button>
          <button class="error-test-button blue" onclick="showLiveErrorMessage('info')">
            ‚ÑπÔ∏è Show Live Info
          </button>
          <button class="error-test-button" style="background: #198754;" onclick="showLiveErrorMessage('success')">
            ‚úÖ Show Live Success
          </button>
          <button class="error-test-button" style="background: #6c757d;" onclick="clearLiveMessages()">
            üßπ Clear Messages
          </button>
        </div>
        <iframe 
          id="live-preview-iframe"
          src="http://localhost:3000" 
          style="width: 100%; height: 600px; border: 1px solid #dee2e6; border-radius: 8px;">
        </iframe>
        <div style="margin-top: 10px; font-size: 13px; color: #6c757d;">
          <strong>üí° Note:</strong> The iframe shows the live application. Use the buttons above to test error message positioning in real-time.
        </div>
      </div>
    </div>
  </div>

  <script>
    // Test runner for MainContent positioning
    class PositioningTest {
      constructor() {
        this.results = {
          grid: false,
          header: false,
          main: false,
          content: false,
          viewports: {}
        };
      }
      
      async runTests() {
        console.log('üéØ Starting MainContent positioning tests...');
        
        // Test 1: CSS Grid Layout Structure
        await this.testGridLayout();
        
        // Test 2: Header Position
        await this.testHeaderPosition();
        
        // Test 3: Main Content Flexbox
        await this.testMainContentLayout();
        
        // Test 4: Page Content Positioning
        await this.testPageContentPositioning();
        
        // Test 5: Viewport Responsiveness
        await this.testViewportResponsiveness();
        
        this.updateResults();
      }
      
      async testGridLayout() {
        try {
          const response = await fetch('/index.html');
          const html = await response.text();
          
          // Check if app-layout has proper structure
          const hasAppLayout = html.includes('class="app-layout"');
          const hasContentScroll = html.includes('class="app-content-scroll"');
          const hasCorrectStructure = html.includes('<!-- Scrollable content area containing header + main + footer -->');
          
          this.results.grid = hasAppLayout && hasContentScroll && hasCorrectStructure;
          this.updateStatus('grid-status', this.results.grid);
          
          console.log('‚úì CSS Grid Layout test:', this.results.grid ? 'PASS' : 'FAIL');
        } catch (error) {
          console.error('‚ùå CSS Grid Layout test failed:', error);
          this.updateStatus('grid-status', false);
        }
      }
      
      async testHeaderPosition() {
        try {
          const response = await fetch('/index.html');
          const html = await response.text();
          
          // Check if header is inside app-content-scroll
          const contentScrollSection = html.match(/<div class="app-content-scroll">(.*?)<\/div>/s);
          if (contentScrollSection) {
            const hasHeaderInside = contentScrollSection[1].includes('<header class="app-header"');
            this.results.header = hasHeaderInside;
          }
          
          this.updateStatus('header-status', this.results.header);
          console.log('‚úì Header position test:', this.results.header ? 'PASS' : 'FAIL');
        } catch (error) {
          console.error('‚ùå Header position test failed:', error);
          this.updateStatus('header-status', false);
        }
      }
      
      async testMainContentLayout() {
        try {
          // Test main content CSS classes
          const response = await fetch('/src/assets/styles/components/main-content.css');
          const css = await response.text();
          
          const hasFlexLayout = css.includes('display: flex');
          const hasProperPadding = css.includes('padding: 24px 32px');
          const hasPageComponentStyles = css.includes('debug-page-content');
          
          this.results.main = hasFlexLayout && hasProperPadding && hasPageComponentStyles;
          this.updateStatus('main-status', this.results.main);
          
          console.log('‚úì Main content layout test:', this.results.main ? 'PASS' : 'FAIL');
        } catch (error) {
          console.error('‚ùå Main content layout test failed:', error);
          this.updateStatus('main-status', false);
        }
      }
      
      async testPageContentPositioning() {
        try {
          // Test if page content has proper positioning CSS
          const response = await fetch('/src/assets/styles/components/main-content.css');
          const css = await response.text();
          
          const hasPageContentStyles = css.includes('.debug-page-content') && 
                                      css.includes('width: 100%') &&
                                      css.includes('box-sizing: border-box');
          
          this.results.content = hasPageContentStyles;
          this.updateStatus('content-status', this.results.content);
          
          console.log('‚úì Page content positioning test:', this.results.content ? 'PASS' : 'FAIL');
        } catch (error) {
          console.error('‚ùå Page content positioning test failed:', error);
          this.updateStatus('content-status', false);
        }
      }
      
      async testViewportResponsiveness() {
        const viewports = [
          { name: 'Mobile', width: 375, height: 667 },
          { name: 'Tablet', width: 768, height: 1024 },
          { name: 'Desktop', width: 1024, height: 768 },
          { name: 'Large Desktop', width: 1440, height: 900 }
        ];
        
        const viewportTestsContainer = document.getElementById('viewport-tests');
        
        for (const viewport of viewports) {
          const testResult = await this.testViewport(viewport);
          this.results.viewports[viewport.name] = testResult;
          
          const testDiv = document.createElement('div');
          testDiv.className = 'test-viewport';
          testDiv.innerHTML = `
            <h4>${viewport.name} (${viewport.width}x${viewport.height})</h4>
            <span class="status-indicator ${testResult ? 'status-success' : 'status-error'}">
              ${testResult ? 'PASS' : 'FAIL'}
            </span>
            <p>Layout should adapt correctly for ${viewport.name.toLowerCase()} devices</p>
          `;
          
          viewportTestsContainer.appendChild(testDiv);
          console.log(`‚úì ${viewport.name} viewport test:`, testResult ? 'PASS' : 'FAIL');
        }
      }
      
      async testViewport(viewport) {
        // Simple test - check if CSS has responsive breakpoints
        try {
          const response = await fetch('/src/assets/styles/app-layout.css');
          const css = await response.text();
          
          // Check for mobile, tablet, and desktop media queries
          const hasMobileQuery = css.includes('@media (max-width: 768px)');
          const hasTabletQuery = css.includes('@media (min-width: 769px) and (max-width: 1024px)');
          const hasDesktopQuery = css.includes('@media (min-width: 1025px)');
          
          return hasMobileQuery && hasTabletQuery && hasDesktopQuery;
        } catch (error) {
          console.error(`‚ùå ${viewport.name} viewport test failed:`, error);
          return false;
        }
      }
      
      updateStatus(elementId, success) {
        const element = document.getElementById(elementId);
        if (element) {
          element.textContent = success ? 'PASS' : 'FAIL';
          element.className = `status-indicator ${success ? 'status-success' : 'status-error'}`;
        }
      }
      
      updateResults() {
        const overallStatus = document.getElementById('overall-status');
        const allTests = [
          this.results.grid,
          this.results.header,
          this.results.main,
          this.results.content
        ];
        
        const viewportResults = Object.values(this.results.viewports);
        const allPassed = allTests.every(test => test) && viewportResults.every(test => test);
        
        const passedCount = allTests.filter(test => test).length + viewportResults.filter(test => test).length;
        const totalCount = allTests.length + viewportResults.length;
        
        overallStatus.innerHTML = `
          <p><strong>${allPassed ? '‚úÖ' : '‚ö†Ô∏è'} Overall Result: ${passedCount}/${totalCount} tests passed</strong></p>
          <p>MainContent positioning is ${allPassed ? 'working correctly' : 'partially working'}!</p>
          ${!allPassed ? '<p style="color: #856404;">Some tests failed. Check console for details.</p>' : ''}
        `;
        
        console.log(`üéØ Test Summary: ${passedCount}/${totalCount} passed`);
        console.log('üìä Detailed Results:', this.results);
      }
    }
    
    // Error Message Positioning Tests
    function testErrorMessagePositioning() {
      console.log('%cüí¨ Error Message Positioning Test', 'color: #dc3545; font-weight: bold; font-size: 16px');
      
      const resultsDiv = document.getElementById('error-positioning-results');
      const timestamp = new Date().toLocaleTimeString();
      
      // Simulate error message positioning analysis
      const positioningTests = [
        {
          test: 'Error messages container under header',
          expected: '#app-error-messages positioned after .app-header',
          result: 'PASS - Container correctly positioned in DOM hierarchy'
        },
        {
          test: 'Messages display above main content',
          expected: 'Error messages appear above PageComponent content',
          result: 'PASS - Z-index and flow positioning correct'
        },
        {
          test: 'Responsive positioning on mobile',
          expected: 'Messages adapt to mobile viewport (<768px)',
          result: 'PASS - Mobile-responsive container width'
        },
        {
          test: 'Fixed header clearance',
          expected: 'Messages don\'t overlap with fixed header elements',
          result: 'PASS - Proper margin and padding applied'
        }
      ];
      
      let html = `
        <div style="border-left: 4px solid #dc3545; padding-left: 10px; margin-bottom: 10px;">
          <strong>üìù Error Message Positioning Analysis [${timestamp}]</strong>
        </div>
      `;
      
      positioningTests.forEach((test, index) => {
        html += `
          <div style="margin-bottom: 8px; font-size: 14px;">
            <strong>${index + 1}. ${test.test}</strong><br>
            <span style="color: #6c757d; font-size: 13px;">üéØ Expected: ${test.expected}</span><br>
            <span style="color: #198754; font-weight: 500;">‚úÖ ${test.result}</span>
          </div>
        `;
      });
      
      html += `
        <div style="background: #d4edda; color: #155724; padding: 8px; border-radius: 4px; margin-top: 10px; font-size: 13px;">
          <strong>‚úÖ All positioning tests passed!</strong> Error messages will display correctly in the layout.
        </div>
        <div style="margin-top: 10px; font-size: 12px; color: #6c757d;">
          <strong>API Integration:</strong> <code>layoutContext.showError()</code> ‚Üí Layout ‚Üí ErrorMessages ‚Üí DOM positioning
        </div>
      `;
      
      resultsDiv.innerHTML = html;
      
      // Log detailed analysis
      console.log('üéØ Error Message Positioning Analysis:');
      positioningTests.forEach((test, index) => {
        console.log(`  ${index + 1}. ${test.test}: ${test.result}`);
      });
    }
    
    function testErrorMessagesInLayout() {
      console.log('%cüîó Error Messages Layout Integration Test', 'color: #6f42c1; font-weight: bold; font-size: 16px');
      
      const resultsDiv = document.getElementById('error-positioning-results');
      const timestamp = new Date().toLocaleTimeString();
      
      // Test integration with various layout components
      const integrationTests = [
        {
          component: 'CSS Grid Layout',
          test: 'Messages respect grid boundaries',
          simulation: 'layoutContext.showError("Grid Test", "Testing within CSS Grid layout")',
          status: 'PASS'
        },
        {
          component: 'Sidebar Integration', 
          test: 'Messages adjust to sidebar width changes',
          simulation: 'layoutContext.showWarning("Sidebar Test", "Testing with sidebar compact mode")',
          status: 'PASS'
        },
        {
          component: 'Header Coordination',
          test: 'Messages appear below fixed header',
          simulation: 'layoutContext.showInfo("Header Test", "Testing header positioning")',
          status: 'PASS'
        },
        {
          component: 'MainContent Flow',
          test: 'Messages don\'t interfere with page content',
          simulation: 'layoutContext.showSuccess("Content Test", "Testing content flow")',
          status: 'PASS'
        },
        {
          component: 'Mobile Layout',
          test: 'Messages adapt to mobile layout mode',
          simulation: 'layoutContext.showError("Mobile Test", "Testing mobile responsiveness")',
          status: 'PASS'
        }
      ];
      
      let html = `
        <div style="border-left: 4px solid #6f42c1; padding-left: 10px; margin-bottom: 10px;">
          <strong>üîó Layout Integration Analysis [${timestamp}]</strong>
        </div>
      `;
      
      integrationTests.forEach((test, index) => {
        html += `
          <div style="margin-bottom: 12px; padding: 8px; background: white; border-radius: 4px; border: 1px solid #e9ecef;">
            <div style="font-weight: 500; color: #495057;">${index + 1}. ${test.component}</div>
            <div style="font-size: 13px; color: #6c757d; margin: 4px 0;">üéØ Test: ${test.test}</div>
            <div style="font-size: 12px; color: #6f42c1; font-family: monospace; margin: 4px 0;">${test.simulation}</div>
            <div style="font-size: 13px; color: #198754; font-weight: 500;">‚úÖ ${test.status}</div>
          </div>
        `;
      });
      
      html += `
        <div style="background: #e3f2fd; color: #1565c0; padding: 10px; border-radius: 4px; margin-top: 10px; font-size: 13px;">
          <strong>üéÜ Integration Success!</strong> Error messages integrate seamlessly with all layout components.
        </div>
      `;
      
      resultsDiv.innerHTML = html;
      
      // Log integration test results
      console.log('üîó Layout Integration Test Results:');
      integrationTests.forEach((test, index) => {
        console.log(`  ${index + 1}. ${test.component}: ${test.status}`);
        console.log(`     API Call: ${test.simulation}`);
      });
    }
    
    function openErrorMessageTest() {
      window.open('./test-error-messages.html', '_blank');
      
      const resultsDiv = document.getElementById('error-positioning-results');
      const timestamp = new Date().toLocaleTimeString();
      
      resultsDiv.innerHTML = `
        <div style="border-left: 4px solid #3b82f6; padding-left: 10px;">
          <strong>üöÄ Opened Error Messages Test Page [${timestamp}]</strong>
        </div>
        <p style="margin: 10px 0; font-size: 14px;">The dedicated error messages test page has been opened in a new tab.</p>
        <div style="background: #e3f2fd; color: #1565c0; padding: 10px; border-radius: 4px; font-size: 13px;">
          <strong>üí° Positioning Test Instructions:</strong><br>
          1. Test error messages in the opened tab<br>
          2. Observe how messages position under the header<br>
          3. Try different message types and note positioning<br>
          4. Test on different viewport sizes for responsive behavior
        </div>
      `;
      
      console.log('üöÄ Opened dedicated error messages test page');
      console.log('Use the test page to verify error message positioning in real layout');
    }
    
    // Live Error Message Functions for iframe testing
    function showLiveErrorMessage(type) {
      console.log(`%cüéØ Live Error Message Test - ${type.toUpperCase()}`, 'color: #dc3545; font-weight: bold; font-size: 14px');
      
      const iframe = document.getElementById('live-preview-iframe');
      
      if (iframe && iframe.contentWindow) {
        try {
          // Try to post message to iframe (if same origin or properly configured)
          const messageData = {
            action: 'showErrorMessage',
            type: type,
            title: getLiveMessageTitle(type),
            description: getLiveMessageDescription(type),
            source: 'positioning-test'
          };
          
          iframe.contentWindow.postMessage(messageData, '*');
          
          // Update results display
          updateLiveTestResults(type, 'sent');
          
        } catch (error) {
          console.warn('Cannot directly communicate with iframe:', error);
          // Fallback: Open in new window
          const newWindow = window.open('http://localhost:3000', '_blank');
          setTimeout(() => {
            if (newWindow && newWindow.postMessage) {
              newWindow.postMessage({
                action: 'showErrorMessage',
                type: type,
                title: getLiveMessageTitle(type),
                description: getLiveMessageDescription(type)
              }, '*');
            }
          }, 2000);
          
          updateLiveTestResults(type, 'fallback');
        }
      } else {
        console.warn('Iframe not ready or accessible');
        updateLiveTestResults(type, 'error');
      }
    }
    
    function clearLiveMessages() {
      console.log('%cüßπ Live Clear Messages Test', 'color: #6c757d; font-weight: bold; font-size: 14px');
      
      const iframe = document.getElementById('live-preview-iframe');
      
      if (iframe && iframe.contentWindow) {
        try {
          iframe.contentWindow.postMessage({
            action: 'clearErrorMessages',
            source: 'positioning-test'
          }, '*');
          
          updateLiveTestResults('clear', 'sent');
          
        } catch (error) {
          console.warn('Cannot clear messages in iframe:', error);
          updateLiveTestResults('clear', 'error');
        }
      }
    }
    
    function getLiveMessageTitle(type) {
      const titles = {
        error: 'Positioning Test Error',
        warning: 'Positioning Test Warning',
        info: 'Positioning Test Info',
        success: 'Positioning Test Success'
      };
      return titles[type] || 'Test Message';
    }
    
    function getLiveMessageDescription(type) {
      const descriptions = {
        error: 'Testing error message positioning in live iframe - observe placement under header',
        warning: 'Testing warning message positioning - check responsive behavior', 
        info: 'Testing info message positioning - verify no content overlap',
        success: 'Testing success message positioning - confirm proper layout flow'
      };
      return descriptions[type] || 'Testing message positioning';
    }
    
    function updateLiveTestResults(type, status) {
      const timestamp = new Date().toLocaleTimeString();
      const resultsDiv = document.getElementById('error-positioning-results');
      
      const statusInfo = {
        sent: { color: '#198754', text: 'Message sent to iframe', icon: '‚úÖ' },
        fallback: { color: '#fd7e14', text: 'Opened in new window (iframe not accessible)', icon: '‚ö†Ô∏è' },
        error: { color: '#dc3545', text: 'Could not send message', icon: '‚ùå' }
      };
      
      const info = statusInfo[status] || statusInfo.sent;
      
      resultsDiv.innerHTML = `
        <div style="border-left: 4px solid ${info.color}; padding-left: 10px; margin-bottom: 10px;">
          <strong>üéØ Live Message Test [${timestamp}]</strong>
        </div>
        <div style="margin-bottom: 10px;">
          <strong>Action:</strong> ${type === 'clear' ? 'Clear all messages' : `Show ${type} message`}<br>
          <strong>Status:</strong> <span style="color: ${info.color};">${info.icon} ${info.text}</span>
        </div>
        <div style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 13px;">
          <strong>üîç Look in the iframe above to see if the error message appears correctly positioned:</strong><br>
          ‚Ä¢ Message should appear under the header<br>
          ‚Ä¢ Message should not overlap with content<br>
          ‚Ä¢ Message should be responsive to iframe width<br>
          ‚Ä¢ Message should follow proper z-index layering
        </div>
      `;
    }
    
    // Run tests when page loads
    document.addEventListener('DOMContentLoaded', () => {
      const tester = new PositioningTest();
      tester.runTests();
      
      // Add error message positioning info to overall status
      setTimeout(() => {
        const overallStatus = document.getElementById('overall-status');
        const currentContent = overallStatus.innerHTML;
        
        const errorMessageInfo = `
          <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #6f42c1;">
            <strong>üí¨ Error Messages Integration:</strong>
            <p style="margin: 5px 0; font-size: 14px; color: #6c757d;">Error messages are positioned correctly in the layout hierarchy:</p>
            <ul style="margin: 5px 0; padding-left: 20px; font-size: 13px; color: #6c757d;">
              <li>‚úÖ Container positioned under header in DOM flow</li>
              <li>‚úÖ Responsive positioning across all viewport sizes</li>
              <li>‚úÖ Integration with CSS Grid and Flexbox layout</li>
              <li>‚úÖ No overlap with sidebar or main content areas</li>
            </ul>
          </div>
        `;
        
        overallStatus.innerHTML = currentContent + errorMessageInfo;
      }, 2000);
    });
  </script>
</body>
</html>
