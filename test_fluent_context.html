<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fluent Context Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        .warning { color: orange; }
        button {
            margin: 5px;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #007bff;
            color: white;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .code-example {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 10px 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <!-- Required layout structure -->
    <div class="app-layout">
        <div id="app-error-messages" class="app-error-messages" role="alert" aria-live="polite" style="display: none;"></div>
        <div class="app-header">
            <h1>üîó Fluent Context Interface Test</h1>
        </div>
        <div class="app-content-scroll">
            <main class="app-main" id="app">
                <div class="test-container">
                    <h2>üéØ Testing Layout.withContext() Fluent Interface</h2>
                    <p>The <code>withContext()</code> method provides a fluent interface to safely work with LayoutContext:</p>
                    
                    <div class="code-example">
<strong>Usage Pattern:</strong>
layout
  .withContext(ctx => {
    // Work with LayoutContext here
    const messages = ctx.getMessages();
    if (messages) {
      messages.showError('Title', 'Description');
    }
  })
  .withContext(ctx => {
    // Chain multiple context operations
    const viewport = ctx.getViewport();
    console.log('Viewport:', viewport);
  });
                    </div>
                    
                    <div>
                        <h3>üß™ Test Fluent Interface</h3>
                        <button onclick="testBasicFluentUsage()">Basic Fluent Usage</button>
                        <button onclick="testChainedOperations()">Chained Operations</button>
                        <button onclick="testErrorHandling()">Error Handling</button>
                        <button onclick="testMessagesViaFluent()">Messages via Fluent</button>
                    </div>
                    
                    <div>
                        <h3>üì® Message Testing via Fluent Interface</h3>
                        <button onclick="showFluentError()">Fluent Error</button>
                        <button onclick="showFluentWarning()">Fluent Warning</button>
                        <button onclick="showFluentInfo()">Fluent Info</button>
                        <button onclick="showFluentSuccess()">Fluent Success</button>
                        <button onclick="clearFluentMessages()">Clear via Fluent</button>
                    </div>
                </div>

                <div class="test-container">
                    <h3>üìã Test Results</h3>
                    <div id="test-log" class="log"></div>
                </div>
            </main>
        </div>
    </div>

    <script type="module">
        import Layout from './src/components/Layout.js';

        let layout = null;

        async function initializeApp() {
            try {
                log('üöÄ Initializing Layout for fluent interface testing...', 'info');
                
                layout = new Layout({
                    header: { enabled: true, brandTitle: 'Fluent Context Test' },
                    sidebar: { enabled: false },
                    footer: { enabled: true }
                });

                await layout.init();
                
                log('‚úÖ Layout initialized successfully', 'success');
                log('‚úÖ withContext() method ready for testing', 'success');
                
            } catch (error) {
                log(`‚ùå Initialization failed: ${error.message}`, 'error');
            }
        }

        function log(message, type = 'info') {
            const logDiv = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // Test functions
        window.testBasicFluentUsage = () => {
            log('üîç Testing basic fluent usage...', 'info');
            
            try {
                const result = layout.withContext(layoutContext => {
                    log('‚úÖ Handler called with LayoutContext', 'success');
                    log(`LayoutContext available: ${layoutContext ? 'YES' : 'NO'}`, layoutContext ? 'success' : 'error');
                    
                    const viewport = layoutContext.getViewport();
                    log(`Viewport: ${viewport.width}x${viewport.height}`, 'info');
                });
                
                log(`withContext() returned: ${result === layout ? 'Layout instance (fluent!)' : 'unexpected'}`, 
                    result === layout ? 'success' : 'warning');
                
            } catch (error) {
                log(`‚ùå Basic fluent usage failed: ${error.message}`, 'error');
            }
        };

        window.testChainedOperations = () => {
            log('üîç Testing chained operations...', 'info');
            
            try {
                layout
                    .withContext(ctx => {
                        log('‚úÖ First chained operation', 'success');
                        const layoutMode = ctx.getLayoutMode();
                        log(`Layout mode: ${layoutMode.type}`, 'info');
                    })
                    .withContext(ctx => {
                        log('‚úÖ Second chained operation', 'success');
                        const breakpoints = ctx.getBreakpoints();
                        log(`Mobile breakpoint: ${breakpoints.mobile}px`, 'info');
                    })
                    .withContext(ctx => {
                        log('‚úÖ Third chained operation', 'success');
                        const canToggle = ctx.canSidebarToggle();
                        log(`Can toggle sidebar: ${canToggle}`, 'info');
                    });
                
                log('‚úÖ All chained operations completed successfully', 'success');
                
            } catch (error) {
                log(`‚ùå Chained operations failed: ${error.message}`, 'error');
            }
        };

        window.testErrorHandling = () => {
            log('üîç Testing error handling in fluent interface...', 'info');
            
            try {
                layout.withContext(ctx => {
                    log('‚úÖ Handler called - about to throw error...', 'info');
                    throw new Error('Intentional test error');
                });
                
                log('‚úÖ Error was handled gracefully by withContext()', 'success');
                
            } catch (error) {
                log(`‚ùå Error not handled properly: ${error.message}`, 'error');
            }
        };

        window.testMessagesViaFluent = () => {
            log('üîç Testing Messages access via fluent interface...', 'info');
            
            try {
                layout.withContext(ctx => {
                    const messages = ctx.getMessages();
                    if (messages) {
                        log('‚úÖ Messages interface obtained via fluent context', 'success');
                        log(`Messages.isReady(): ${messages.isReady()}`, 'success');
                        
                        const hasMessages = messages.hasMessages();
                        log(`Current messages count: ${hasMessages ? 'has messages' : 'no messages'}`, 'info');
                    } else {
                        log('‚ùå Messages interface not available', 'error');
                    }
                });
                
            } catch (error) {
                log(`‚ùå Messages test failed: ${error.message}`, 'error');
            }
        };

        // Message testing via fluent interface
        window.showFluentError = () => {
            layout.withContext(ctx => {
                const messages = ctx.getMessages();
                if (messages) {
                    messages.showError('Fluent Error', 'This error was shown via the fluent withContext interface');
                    log('‚úÖ Error message shown via fluent interface', 'success');
                }
            });
        };

        window.showFluentWarning = () => {
            layout.withContext(ctx => {
                const messages = ctx.getMessages();
                if (messages) {
                    messages.showWarning('Fluent Warning', 'This warning was shown via the fluent withContext interface');
                    log('‚úÖ Warning message shown via fluent interface', 'success');
                }
            });
        };

        window.showFluentInfo = () => {
            layout.withContext(ctx => {
                const messages = ctx.getMessages();
                if (messages) {
                    messages.showInfo('Fluent Info', 'This info was shown via the fluent withContext interface');
                    log('‚úÖ Info message shown via fluent interface', 'success');
                }
            });
        };

        window.showFluentSuccess = () => {
            layout.withContext(ctx => {
                const messages = ctx.getMessages();
                if (messages) {
                    messages.showSuccess('Fluent Success', 'This success was shown via the fluent withContext interface');
                    log('‚úÖ Success message shown via fluent interface', 'success');
                }
            });
        };

        window.clearFluentMessages = () => {
            layout.withContext(ctx => {
                const messages = ctx.getMessages();
                if (messages) {
                    messages.clearAll();
                    log('‚úÖ All messages cleared via fluent interface', 'success');
                }
            });
        };

        // Initialize when DOM loads
        document.addEventListener('DOMContentLoaded', initializeApp);

        // Expose for debugging
        window.layout = () => layout;
    </script>
</body>
</html>
