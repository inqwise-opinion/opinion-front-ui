<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurable Header Test</title>
    <link rel="stylesheet" href="src/assets/css/main.css">
    <style>
        body { font-family: Arial, sans-serif; }
        .controls { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: white; 
            padding: 15px; 
            border: 1px solid #ccc; 
            border-radius: 5px; 
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 280px;
        }
        .controls h3 { margin-top: 0; }
        .controls label { 
            display: block; 
            margin: 8px 0 4px 0; 
            font-weight: bold; 
        }
        .controls input[type="text"], .controls input[type="checkbox"] { 
            margin: 4px 0 8px 0; 
        }
        .controls input[type="text"] {
            width: 250px;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        .controls button { 
            display: block; 
            width: 260px; 
            padding: 8px; 
            margin: 5px 0; 
            cursor: pointer;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
        }
        .controls button:hover { background: #0056b3; }
        .status { 
            background: #e1f5fe; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 20px; 
            font-weight: bold;
        }
        .log { 
            background: #f0f0f0; 
            padding: 10px; 
            border-radius: 5px; 
            margin: 20px; 
            font-family: monospace; 
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .config-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 20px;
            border: 1px solid #dee2e6;
        }
        .config-display h3 { margin-top: 0; }
        .config-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 4px 0;
            border-bottom: 1px solid #eee;
        }
        .config-item:last-child { border-bottom: none; }
        .config-value { font-weight: bold; color: #007bff; }
    </style>
</head>
<body>
    <!-- Required layout structure -->
    <div class="app-layout">
        <div id="app-error-messages" class="app-error-messages" role="alert" aria-live="polite" style="display: none;"></div>
        <div id="app-header" class="app-header">
            <div class="header-container"></div>
        </div>
        <div class="app-content-scroll">
            <main class="app-main" id="app">
                <div class="status" id="status">
                    Header Configuration Test: <span id="header-status">Loading...</span>
                </div>

                <div class="config-display">
                    <h3>üìã Current Header Configuration</h3>
                    <div id="config-display"></div>
                </div>
                
                <h2>üéõÔ∏è Testing Configurable AppHeaderImpl</h2>
                <p>This test demonstrates configurable header functionality:</p>
                <ul>
                    <li><strong>Brand Configuration</strong>: Set custom brand title and href</li>
                    <li><strong>Feature Toggles</strong>: Enable/disable mobile toggle, breadcrumbs, and user menu</li>
                    <li><strong>Dynamic Updates</strong>: Update configuration at runtime</li>
                    <li><strong>Layout Integration</strong>: Configuration flows from Layout to AppHeaderImpl</li>
                </ul>

                <div id="test-log" class="log"></div>
            </main>
            <footer class="app-footer">
                <p>Footer - Configurable Header Test</p>
            </footer>
        </div>
    </div>

    <div class="controls">
        <h3>üéõÔ∏è Header Configuration</h3>
        
        <label for="brand-title">Brand Title:</label>
        <input type="text" id="brand-title" value="Custom Brand">
        
        <label for="brand-href">Brand Href:</label>
        <input type="text" id="brand-href" value="/custom">
        
        <label>
            <input type="checkbox" id="show-mobile-toggle" checked> Show Mobile Toggle
        </label>
        
        <label>
            <input type="checkbox" id="show-breadcrumbs" checked> Show Breadcrumbs
        </label>
        
        <label>
            <input type="checkbox" id="show-user-menu" checked> Show User Menu
        </label>
        
        <button onclick="createConfiguredLayout()">Create Custom Layout</button>
        <button onclick="testHeaderMethods()">Test Header Methods</button>
        <button onclick="toggleFeatures()">Toggle All Features</button>
        <button onclick="resetToDefaults()">Reset to Defaults</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <script type="module">
        import Layout from './src/components/Layout.js';

        let layout = null;
        let currentConfig = {};

        function log(message, type = 'info') {
            const logDiv = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function updateStatus(status) {
            document.getElementById('header-status').textContent = status;
        }

        function displayConfig(config) {
            const configDiv = document.getElementById('config-display');
            configDiv.innerHTML = Object.entries(config)
                .map(([key, value]) => `
                    <div class="config-item">
                        <span>${key}:</span>
                        <span class="config-value">${value}</span>
                    </div>
                `).join('');
        }

        function getConfigFromInputs() {
            return {
                brandTitle: document.getElementById('brand-title').value,
                brandHref: document.getElementById('brand-href').value,
                showMobileToggle: document.getElementById('show-mobile-toggle').checked,
                showBreadcrumbs: document.getElementById('show-breadcrumbs').checked,
                showUserMenu: document.getElementById('show-user-menu').checked,
            };
        }

        async function createLayoutWithConfig(headerConfig) {
            try {
                // Clean up existing layout
                if (layout) {
                    layout.destroy();
                }

                log('üöÄ Creating Layout with header config...', 'info');
                log(`üìã Header Config: ${JSON.stringify(headerConfig, null, 2)}`, 'info');

                // Create layout with header configuration
                layout = new Layout({
                    header: {
                        enabled: true,
                        ...headerConfig
                    },
                    sidebar: { enabled: false },
                    footer: { enabled: true }
                });

                await layout.init();
                
                // Get the actual config from the header
                const header = layout.getHeader();
                const actualConfig = header.getConfig();
                
                displayConfig(actualConfig);
                currentConfig = actualConfig;
                
                log('‚úÖ Layout with configured header created successfully', 'success');
                log(`‚úÖ Actual header config: ${JSON.stringify(actualConfig, null, 2)}`, 'success');
                
                updateStatus('Configured and Active');
                
                return layout;
                
            } catch (error) {
                log(`‚ùå Failed to create configured layout: ${error.message}`, 'error');
                updateStatus('Error');
            }
        }

        window.createConfiguredLayout = () => {
            const headerConfig = getConfigFromInputs();
            log('üéØ Creating layout with custom header configuration...', 'info');
            createLayoutWithConfig(headerConfig);
        };

        window.testHeaderMethods = () => {
            log('üß™ Testing header methods...', 'info');
            
            if (!layout) {
                log('‚ùå No layout available for testing', 'error');
                return;
            }

            const header = layout.getHeader();
            
            // Test brand update
            log('üîÑ Testing brand update...', 'info');
            setTimeout(() => {
                header.updateBrand('Test Brand', '/test');
                log('‚úÖ Brand updated to "Test Brand" -> /test', 'success');
            }, 1000);

            // Test page title update
            setTimeout(() => {
                log('üîÑ Testing page title update...', 'info');
                header.updatePageTitle('Custom Page');
                log('‚úÖ Page title updated to "Custom Page"', 'success');
            }, 2000);

            // Test breadcrumbs
            setTimeout(() => {
                log('üîÑ Testing breadcrumbs update...', 'info');
                header.updateBreadcrumbs('Settings', 'Profile');
                log('‚úÖ Breadcrumbs updated to "Settings > Profile"', 'success');
            }, 3000);

            // Test visibility toggle
            setTimeout(() => {
                log('üîÑ Testing header visibility toggle...', 'info');
                header.setVisible(false);
                log('‚úÖ Header hidden', 'success');
                
                setTimeout(() => {
                    header.setVisible(true);
                    log('‚úÖ Header shown', 'success');
                }, 1000);
            }, 4000);
        };

        window.toggleFeatures = () => {
            const currentToggles = {
                mobile: document.getElementById('show-mobile-toggle').checked,
                breadcrumbs: document.getElementById('show-breadcrumbs').checked,
                userMenu: document.getElementById('show-user-menu').checked,
            };

            // Toggle all features
            document.getElementById('show-mobile-toggle').checked = !currentToggles.mobile;
            document.getElementById('show-breadcrumbs').checked = !currentToggles.breadcrumbs;
            document.getElementById('show-user-menu').checked = !currentToggles.userMenu;

            log('üîÑ Toggled all features, creating new layout...', 'info');
            window.createConfiguredLayout();
        };

        window.resetToDefaults = () => {
            document.getElementById('brand-title').value = 'Opinion';
            document.getElementById('brand-href').value = '/dashboard';
            document.getElementById('show-mobile-toggle').checked = true;
            document.getElementById('show-breadcrumbs').checked = true;
            document.getElementById('show-user-menu').checked = true;

            log('üîÑ Reset to default configuration...', 'info');
            window.createConfiguredLayout();
        };

        window.clearLog = () => {
            document.getElementById('test-log').innerHTML = '';
        };

        // Initialize with default configuration
        log('üéØ Configurable Header test starting...', 'info');
        updateStatus('Initializing...');
        
        // Create initial layout with default config
        createLayoutWithConfig({
            brandTitle: 'Header Test',
            brandHref: '/test',
            showMobileToggle: true,
            showBreadcrumbs: true,
            showUserMenu: true,
        });
    </script>
</body>
</html>
