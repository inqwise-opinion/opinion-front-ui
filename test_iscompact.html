<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>isCompact() Test</title>
    <link rel="stylesheet" href="src/assets/css/main.css">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .log { background: #f0f0f0; padding: 10px; border-radius: 5px; margin: 10px 0; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .result { font-weight: bold; color: green; }
        .error { font-weight: bold; color: red; }
        .compact-status { 
            background: #e1f5fe; 
            border: 1px solid #0288d1; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 10px 0; 
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>üîç isCompact() Method Test</h1>
    
    <div id="app-error-messages" class="app-error-messages" role="alert" aria-live="polite" style="display: none;"></div>
    
    <div class="compact-status" id="compact-status">
        Compact Status: <span id="compact-value">Unknown</span>
    </div>
    
    <button onclick="testLayoutContext()">Test LayoutContext.isCompact()</button>
    <button onclick="testWithContext()">Test via withContext()</button>
    <button onclick="testLayoutMode()">Test getLayoutMode().isCompact</button>
    <button onclick="clearLog()">Clear Log</button>
    
    <div id="log" class="log"></div>

    <script type="module">
        import Layout from './src/components/Layout.js';

        let layout = null;

        function log(message, className = '') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
        }

        function updateCompactStatus(isCompact) {
            const statusElement = document.getElementById('compact-value');
            statusElement.textContent = isCompact ? 'TRUE (Compact Mode)' : 'FALSE (Normal Mode)';
            statusElement.style.color = isCompact ? '#d32f2f' : '#388e3c';
        }

        window.log = log;

        // Initialize layout
        async function initializeLayout() {
            try {
                layout = new Layout({
                    header: { enabled: true, brandTitle: 'Compact Test' },
                    sidebar: { enabled: false },
                    footer: { enabled: true }
                });
                
                await layout.init();
                log('‚úÖ Layout initialized successfully', 'result');
                
                // Test initial compact state
                const layoutContext = layout.getLayoutContext();
                const initialCompact = layoutContext.isCompact();
                updateCompactStatus(initialCompact);
                log(`Initial compact state: ${initialCompact}`, 'result');
                
            } catch (error) {
                log(`‚ùå Layout initialization failed: ${error.message}`, 'error');
            }
        }

        window.testLayoutContext = () => {
            log('üîç Testing LayoutContext.isCompact() directly...', 'result');
            
            try {
                const layoutContext = layout?.getLayoutContext();
                if (layoutContext) {
                    const isCompact = layoutContext.isCompact();
                    updateCompactStatus(isCompact);
                    log(`‚úÖ LayoutContext.isCompact(): ${isCompact}`, 'result');
                } else {
                    log('‚ùå LayoutContext not available', 'error');
                }
            } catch (error) {
                log(`‚ùå Error testing LayoutContext.isCompact(): ${error.message}`, 'error');
            }
        };

        window.testWithContext = () => {
            log('üîç Testing isCompact() via withContext()...', 'result');
            
            try {
                layout?.withContext(ctx => {
                    const isCompact = ctx.isCompact();
                    updateCompactStatus(isCompact);
                    log(`‚úÖ Via withContext - isCompact(): ${isCompact}`, 'result');
                    
                    // Also test other layout information
                    const viewport = ctx.getViewport();
                    const layoutMode = ctx.getLayoutMode();
                    
                    log(`Viewport: ${viewport.width}x${viewport.height}`, 'result');
                    log(`Layout mode type: ${layoutMode.type}`, 'result');
                    log(`Layout mode isCompact: ${layoutMode.isCompact}`, 'result');
                });
            } catch (error) {
                log(`‚ùå Error testing via withContext(): ${error.message}`, 'error');
            }
        };

        window.testLayoutMode = () => {
            log('üîç Testing getLayoutMode().isCompact...', 'result');
            
            try {
                const layoutContext = layout?.getLayoutContext();
                if (layoutContext) {
                    const layoutMode = layoutContext.getLayoutMode();
                    const isCompact = layoutMode.isCompact;
                    updateCompactStatus(isCompact);
                    
                    log(`‚úÖ LayoutMode.isCompact: ${isCompact}`, 'result');
                    log(`Layout mode type: ${layoutMode.type}`, 'result');
                    log(`Is mobile: ${layoutMode.isMobile}`, 'result');
                    log(`Is tablet: ${layoutMode.isTablet}`, 'result');
                    log(`Is desktop: ${layoutMode.isDesktop}`, 'result');
                } else {
                    log('‚ùå LayoutContext not available', 'error');
                }
            } catch (error) {
                log(`‚ùå Error testing getLayoutMode(): ${error.message}`, 'error');
            }
        };

        window.clearLog = () => {
            document.getElementById('log').innerHTML = '';
        };

        // Initialize on page load
        initializeLayout();
        
        log('üéØ isCompact() test ready', 'result');
        log('Note: Since no sidebar is registered, isCompact() should return false', 'result');
    </script>
</body>
</html>
