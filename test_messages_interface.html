<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Messages Interface</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        .info { color: blue; }
        button {
            margin: 5px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #007bff;
            color: white;
        }
        button:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <!-- Layout structure -->
    <div class="app-layout">
        <div id="app-error-messages" class="app-error-messages" role="alert" aria-live="polite" style="display: none;"></div>
        <div class="app-header">
            <h1>üß™ Messages Interface Test</h1>
        </div>
        <div class="app-content-scroll">
            <main class="app-main" id="app">
                <div class="test-container">
                    <h2>üéØ Messages Interface Integration Test</h2>
                    <p>This test verifies that the Messages interface works correctly through Layout and LayoutContext.</p>
                    
                    <div>
                        <h3>Test Interface Availability</h3>
                        <button onclick="testInterfaceAvailability()">Test Interface Ready</button>
                        <button onclick="testLayoutMessages()">Test Layout.getMessages()</button>
                        <button onclick="testContextMessages()">Test LayoutContext.getMessages()</button>
                    </div>

                    <div>
                        <h3>Test Messages Interface Methods</h3>
                        <button onclick="testMessagesError()">Messages.showError()</button>
                        <button onclick="testMessagesWarning()">Messages.showWarning()</button>
                        <button onclick="testMessagesInfo()">Messages.showInfo()</button>
                        <button onclick="testMessagesSuccess()">Messages.showSuccess()</button>
                    </div>

                    <div>
                        <h3>Test Messages Management</h3>
                        <button onclick="testHasMessages()">Test hasMessages()</button>
                        <button onclick="testClearMessages()">Test clearMessages()</button>
                        <button onclick="testClearByType()">Test clearMessagesByType()</button>
                        <button onclick="testIsReady()">Test isReady()</button>
                    </div>
                </div>

                <div class="test-container">
                    <h3>üìä Test Results</h3>
                    <div id="test-results" class="log"></div>
                </div>
            </main>
        </div>
    </div>

    <script type="module">
        import Layout from './src/components/Layout.js';

        // Global test variables
        let layout = null;
        let layoutContext = null;
        let messages = null;

        async function initializeTestApp() {
            log('üöÄ Initializing test app...', 'info');
            
            try {
                // Create and initialize layout
                layout = new Layout({
                    header: { enabled: true, brandTitle: 'Messages Test' },
                    sidebar: { enabled: false },
                    footer: { enabled: true }
                });

                await layout.init();
                layoutContext = layout.getLayoutContext();
                
                log('‚úÖ Layout initialized successfully', 'success');
                log('‚úÖ LayoutContext obtained', 'success');
                
                // Wait a moment for everything to be registered
                setTimeout(() => {
                    try {
                        messages = layout.getMessages();
                        log(`‚úÖ Messages interface: ${messages ? 'AVAILABLE' : 'NOT AVAILABLE'}`, messages ? 'success' : 'error');
                        
                        if (messages) {
                            log(`‚úÖ Messages.isReady(): ${messages.isReady()}`, messages.isReady() ? 'success' : 'warning');
                        }
                    } catch (error) {
                        log(`‚ùå Error getting Messages interface: ${error.message}`, 'error');
                    }
                }, 100);
                
            } catch (error) {
                log(`‚ùå Initialization failed: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        }

        function log(message, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            resultsDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        // Test functions
        window.testInterfaceAvailability = () => {
            log('üîç Testing interface availability...', 'info');
            
            try {
                const layoutMessages = layout?.getMessages();
                const contextMessages = layoutContext?.getMessages();
                
                log(`Layout.getMessages(): ${layoutMessages ? 'AVAILABLE' : 'NULL'}`, layoutMessages ? 'success' : 'warning');
                log(`LayoutContext.getMessages(): ${contextMessages ? 'AVAILABLE' : 'NULL'}`, contextMessages ? 'success' : 'warning');
                
                if (layoutMessages && contextMessages) {
                    log('‚úÖ Both interfaces are available', 'success');
                } else {
                    log('‚ö†Ô∏è One or both interfaces are not available', 'warning');
                }
            } catch (error) {
                log(`‚ùå Error testing availability: ${error.message}`, 'error');
            }
        };

        window.testLayoutMessages = () => {
            log('üîç Testing Layout.getMessages()...', 'info');
            
            try {
                const layoutMessages = layout?.getMessages();
                if (layoutMessages) {
                    log('‚úÖ Layout Messages interface obtained', 'success');
                    log(`‚úÖ isReady(): ${layoutMessages.isReady()}`, 'success');
                } else {
                    log('‚ùå Layout Messages interface not available', 'error');
                }
            } catch (error) {
                log(`‚ùå Error with Layout Messages: ${error.message}`, 'error');
            }
        };

        window.testContextMessages = () => {
            log('üîç Testing LayoutContext.getMessages()...', 'info');
            
            try {
                const contextMessages = layoutContext?.getMessages();
                if (contextMessages) {
                    log('‚úÖ LayoutContext Messages interface obtained', 'success');
                    log(`‚úÖ isReady(): ${contextMessages.isReady()}`, 'success');
                } else {
                    log('‚ùå LayoutContext Messages interface not available', 'error');
                }
            } catch (error) {
                log(`‚ùå Error with LayoutContext Messages: ${error.message}`, 'error');
            }
        };

        window.testMessagesError = () => {
            log('üîç Testing Messages.showError()...', 'info');
            
            try {
                const messagesInterface = layout?.getMessages();
                if (messagesInterface) {
                    messagesInterface.showError('Interface Test Error', 'This error was shown via the Messages interface');
                    log('‚úÖ Messages.showError() called successfully', 'success');
                } else {
                    log('‚ùå Messages interface not available', 'error');
                }
            } catch (error) {
                log(`‚ùå Error calling showError(): ${error.message}`, 'error');
            }
        };

        window.testMessagesWarning = () => {
            log('üîç Testing Messages.showWarning()...', 'info');
            
            try {
                const messagesInterface = layout?.getMessages();
                if (messagesInterface) {
                    messagesInterface.showWarning('Interface Test Warning', 'This warning was shown via the Messages interface');
                    log('‚úÖ Messages.showWarning() called successfully', 'success');
                } else {
                    log('‚ùå Messages interface not available', 'error');
                }
            } catch (error) {
                log(`‚ùå Error calling showWarning(): ${error.message}`, 'error');
            }
        };

        window.testMessagesInfo = () => {
            log('üîç Testing Messages.showInfo()...', 'info');
            
            try {
                const messagesInterface = layout?.getMessages();
                if (messagesInterface) {
                    messagesInterface.showInfo('Interface Test Info', 'This info was shown via the Messages interface');
                    log('‚úÖ Messages.showInfo() called successfully', 'success');
                } else {
                    log('‚ùå Messages interface not available', 'error');
                }
            } catch (error) {
                log(`‚ùå Error calling showInfo(): ${error.message}`, 'error');
            }
        };

        window.testMessagesSuccess = () => {
            log('üîç Testing Messages.showSuccess()...', 'info');
            
            try {
                const messagesInterface = layout?.getMessages();
                if (messagesInterface) {
                    messagesInterface.showSuccess('Interface Test Success', 'This success message was shown via the Messages interface');
                    log('‚úÖ Messages.showSuccess() called successfully', 'success');
                } else {
                    log('‚ùå Messages interface not available', 'error');
                }
            } catch (error) {
                log(`‚ùå Error calling showSuccess(): ${error.message}`, 'error');
            }
        };

        window.testHasMessages = () => {
            log('üîç Testing Messages.hasMessages()...', 'info');
            
            try {
                const messagesInterface = layout?.getMessages();
                if (messagesInterface) {
                    const hasAny = messagesInterface.hasMessages();
                    const hasErrors = messagesInterface.hasMessages('error');
                    const hasWarnings = messagesInterface.hasMessages('warning');
                    
                    log(`‚úÖ hasMessages(): ${hasAny}`, 'success');
                    log(`‚úÖ hasMessages('error'): ${hasErrors}`, 'success');
                    log(`‚úÖ hasMessages('warning'): ${hasWarnings}`, 'success');
                } else {
                    log('‚ùå Messages interface not available', 'error');
                }
            } catch (error) {
                log(`‚ùå Error calling hasMessages(): ${error.message}`, 'error');
            }
        };

        window.testClearMessages = () => {
            log('üîç Testing Messages.clearMessages()...', 'info');
            
            try {
                const messagesInterface = layout?.getMessages();
                if (messagesInterface) {
                    messagesInterface.clearMessages();
                    log('‚úÖ Messages.clearMessages() called successfully', 'success');
                } else {
                    log('‚ùå Messages interface not available', 'error');
                }
            } catch (error) {
                log(`‚ùå Error calling clearMessages(): ${error.message}`, 'error');
            }
        };

        window.testClearByType = () => {
            log('üîç Testing Messages.clearMessagesByType()...', 'info');
            
            try {
                const messagesInterface = layout?.getMessages();
                if (messagesInterface) {
                    messagesInterface.clearMessagesByType('error');
                    log('‚úÖ Messages.clearMessagesByType("error") called successfully', 'success');
                } else {
                    log('‚ùå Messages interface not available', 'error');
                }
            } catch (error) {
                log(`‚ùå Error calling clearMessagesByType(): ${error.message}`, 'error');
            }
        };

        window.testIsReady = () => {
            log('üîç Testing Messages.isReady()...', 'info');
            
            try {
                const messagesInterface = layout?.getMessages();
                if (messagesInterface) {
                    const ready = messagesInterface.isReady();
                    log(`‚úÖ Messages.isReady(): ${ready}`, ready ? 'success' : 'warning');
                } else {
                    log('‚ùå Messages interface not available', 'error');
                }
            } catch (error) {
                log(`‚ùå Error calling isReady(): ${error.message}`, 'error');
            }
        };

        // Initialize when DOM loads
        document.addEventListener('DOMContentLoaded', initializeTestApp);

        // Expose for manual testing
        window.layout = () => layout;
        window.layoutContext = () => layoutContext;
        window.messages = () => messages;
    </script>
</body>
</html>
