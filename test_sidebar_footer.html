<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurable Sidebar Footer Test</title>
    <link rel="stylesheet" href="src/assets/css/main.css">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .controls { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: white; 
            padding: 15px; 
            border: 1px solid #ccc; 
            border-radius: 5px; 
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .controls button { 
            display: block; 
            width: 200px; 
            padding: 8px; 
            margin: 5px 0; 
            cursor: pointer; 
        }
        .controls input[type="text"] {
            display: block;
            width: 190px;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        .status { 
            background: #e1f5fe; 
            padding: 10px; 
            border-radius: 5px; 
            margin: 10px 0; 
            font-weight: bold;
        }
        .log { background: #f0f0f0; padding: 10px; border-radius: 5px; margin: 10px 0; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <!-- Required layout structure -->
    <div class="app-layout">
        <div id="app-error-messages" class="app-error-messages" role="alert" aria-live="polite" style="display: none;"></div>
        <div id="app-sidebar" class="app-sidebar">
            <div class="sidebar-header"></div>
            <div class="sidebar-navigation"></div>
            <div class="sidebar-footer"></div>
        </div>
        <div class="app-content-scroll">
            <header class="app-header">
                <h1>ü¶∂ Configurable Sidebar Footer Test</h1>
            </header>
            <main class="app-main" id="app">
                <div class="status" id="status">
                    Footer Status: <span id="footer-status">Loading...</span>
                </div>
                
                <h2>Testing Sidebar Footer Configuration</h2>
                <p>This test demonstrates configurable sidebar footer text using:</p>
                <ul>
                    <li><strong>Layout Configuration</strong>: Set footer text during layout creation</li>
                    <li><strong>SidebarConfig</strong>: Pass footer configuration to sidebar components</li>
                    <li><strong>Dynamic Updates</strong>: Update footer text at runtime</li>
                </ul>

                <div id="test-log" class="log"></div>
            </main>
            <footer class="app-footer">
                <p>App Footer - ¬© 2025 Test App</p>
            </footer>
        </div>
    </div>

    <div class="controls">
        <h3>üéõÔ∏è Controls</h3>
        <input type="text" id="footer-text-input" placeholder="Enter footer text..." value="¬© 2025 Custom Footer">
        <button onclick="updateFooterText()">Update Footer Text</button>
        <button onclick="toggleFooterVisibility()">Toggle Footer Visibility</button>
        <button onclick="testLayoutConfig()">Test Layout Config</button>
        <button onclick="testSidebarMethods()">Test Sidebar Methods</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <script type="module">
        import Layout from './src/components/Layout.js';
        import { SidebarComponent } from './src/components/SidebarComponent.js';

        let layout = null;
        let sidebar = null;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function updateFooterStatus(text, visible) {
            const statusEl = document.getElementById('footer-status');
            if (visible) {
                statusEl.innerHTML = `<span style="color: green;">Visible</span> - "${text}"`;
            } else {
                statusEl.innerHTML = `<span style="color: red;">Hidden</span>`;
            }
        }

        async function initializeApp() {
            try {
                log('üöÄ Creating Layout with custom sidebar footer config...', 'info');
                
                // Create layout with custom sidebar footer configuration
                layout = new Layout({
                    header: { enabled: true, brandTitle: 'Footer Test App' },
                    sidebar: { 
                        enabled: true,
                        footer: {
                            text: '¬© 2025 Opinion Platform',
                            showFooter: true
                        }
                    },
                    footer: { enabled: true }
                });
                
                await layout.init();
                log('‚úÖ Layout initialized with custom footer config', 'success');
                
                // Get footer config from layout
                const footerConfig = layout.getSidebarFooterConfig();
                log(`üìã Layout footer config: "${footerConfig.text}", visible: ${footerConfig.showFooter}`, 'info');
                
                // Create sidebar with footer configuration
                sidebar = new SidebarComponent({
                    defaultWidth: 280,
                    compactWidth: 80,
                    footer: footerConfig
                });
                
                await sidebar.init();
                log('‚úÖ Sidebar initialized with footer configuration', 'success');
                
                updateFooterStatus(footerConfig.text, footerConfig.showFooter);
                
            } catch (error) {
                log(`‚ùå Initialization failed: ${error.message}`, 'error');
            }
        }

        window.updateFooterText = () => {
            const input = document.getElementById('footer-text-input');
            const newText = input.value || '¬© 2025 Default Text';
            
            log(`üîÑ Updating footer text to: "${newText}"`, 'info');
            
            if (sidebar) {
                sidebar.updateFooterText(newText);
                updateFooterStatus(newText, true);
                log('‚úÖ Footer text updated successfully', 'success');
            } else {
                log('‚ùå Sidebar not available', 'error');
            }
        };

        window.toggleFooterVisibility = () => {
            log('üîÑ Toggling footer visibility...', 'info');
            
            if (sidebar) {
                const config = sidebar.getConfig();
                const newVisibility = !config.footer.showFooter;
                
                sidebar.setFooterVisibility(newVisibility);
                updateFooterStatus(config.footer.text, newVisibility);
                log(`‚úÖ Footer visibility: ${newVisibility ? 'shown' : 'hidden'}`, 'success');
            } else {
                log('‚ùå Sidebar not available', 'error');
            }
        };

        window.testLayoutConfig = () => {
            log('üîç Testing layout configuration retrieval...', 'info');
            
            if (layout) {
                const footerConfig = layout.getSidebarFooterConfig();
                log(`üìã Layout sidebar footer config:`, 'info');
                log(`   Text: "${footerConfig.text}"`, 'info');
                log(`   Show Footer: ${footerConfig.showFooter}`, 'info');
            } else {
                log('‚ùå Layout not available', 'error');
            }
        };

        window.testSidebarMethods = () => {
            log('üîç Testing sidebar footer methods...', 'info');
            
            if (sidebar) {
                const config = sidebar.getConfig();
                log(`üìã Sidebar footer config:`, 'info');
                log(`   Text: "${config.footer.text}"`, 'info');
                log(`   Show Footer: ${config.footer.showFooter}`, 'info');
                
                // Test updating with different values
                log('üß™ Testing footer method calls:', 'info');
                
                setTimeout(() => {
                    sidebar.updateFooterText('¬© Test 1 - Method Call');
                    log('   ‚úÖ updateFooterText() called', 'info');
                }, 1000);
                
                setTimeout(() => {
                    sidebar.setFooterVisibility(false);
                    log('   ‚úÖ setFooterVisibility(false) called', 'info');
                    updateFooterStatus('Hidden by method', false);
                }, 2000);
                
                setTimeout(() => {
                    sidebar.setFooterVisibility(true);
                    sidebar.updateFooterText('¬© Test 2 - Restored');
                    log('   ‚úÖ setFooterVisibility(true) and updateFooterText() called', 'info');
                    updateFooterStatus('¬© Test 2 - Restored', true);
                }, 3000);
                
            } else {
                log('‚ùå Sidebar not available', 'error');
            }
        };

        window.clearLog = () => {
            document.getElementById('test-log').innerHTML = '';
        };

        // Initialize the app
        log('üéØ Configurable Sidebar Footer test starting...', 'info');
        initializeApp();
    </script>
</body>
</html>
